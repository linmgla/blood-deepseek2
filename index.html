<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡€æŸ“é˜æ¨“æ´»å‹•è¡Œäº‹æ›† by æ›‰é¢¨</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f8f9fa;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* æš—è‰²ä¸»é¡Œ - å…¨å±€æ¨£å¼ */
        body.dark-theme {
            color: #e9ecef;
            background-color: #121212;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 40px 20px;
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            color: white;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: background-color 0.3s ease;
        }

        body.dark-theme header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }

        .header-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .logo-container {
            background: white;
            padding: 10px;
            border-radius: 12px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .logo {
            width: 80px;
            height: 80px;
            object-fit: contain;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 5px;
            letter-spacing: 1px;
        }

        .author {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s ease;
            background: rgba(255,255,255,0.2);
            color: white;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        .btn:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .btn.active {
            background: white;
            color: #495057;
        }

        body.dark-theme .btn.active {
            background: #e9ecef;
            color: #2c3e50;
        }

        /* æœå°‹èˆ‡ç¯©é¸å€åŸŸ */
        .filter-section {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-direction: column;
            gap: 15px;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
        }

        body.dark-theme .filter-section {
            background: #1e1e1e;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 1px solid #2d2d2d;
        }

        .search-box {
            width: 100%;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #eee;
            border-radius: 10px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s, background-color 0.3s, color 0.3s;
            background-color: white;
            color: #333;
        }

        body.dark-theme .search-box input {
            background-color: #2d2d2d;
            border-color: #444;
            color: #e9ecef;
        }

        .search-box input:focus {
            border-color: #6c757d;
        }

        body.dark-theme .search-box input:focus {
            border-color: #888;
        }

        .location-filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
            color: #333;
        }

        body.dark-theme .location-filters {
            color: #e9ecef;
        }

        .location-tag {
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            cursor: pointer;
            border: 1px solid #ddd;
            background: #f8f9fa;
            color: #333;
            transition: all 0.2s;
        }

        body.dark-theme .location-tag {
            background: #2d2d2d;
            border-color: #444;
            color: #e9ecef;
        }

        .location-tag.active {
            background: #e7f1ff;
            border-color: #0d6efd;
            color: #0d6efd;
        }

        body.dark-theme .location-tag.active {
            background: #003d82;
            border-color: #0d6efd;
            color: #66b3ff;
        }

        /* ç¶²æ ¼æ¨¡å¼æ¨£å¼ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .event-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: transform 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
            border-left: 5px solid #6c757d;
            display: flex;
            flex-direction: column;
        }

        body.dark-theme .event-card {
            background: #1e1e1e;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            border: 1px solid #2d2d2d;
        }

        .event-card:hover {
            transform: translateY(-5px);
        }

        .event-header {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        body.dark-theme .event-header {
            background: #252525;
            border-bottom-color: #333;
        }

        .event-date {
            font-weight: bold;
            color: #6c757d;
            font-size: 0.9rem;
            margin-bottom: 5px;
            transition: color 0.3s ease;
        }

        body.dark-theme .event-date {
            color: #adb5bd;
        }

        .event-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #212529;
            transition: color 0.3s ease;
        }

        body.dark-theme .event-title {
            color: #f8f9fa;
        }

        .event-body {
            padding: 20px;
            flex-grow: 1;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            font-size: 0.95rem;
            color: #333;
            transition: color 0.3s ease;
        }

        body.dark-theme .info-item {
            color: #e9ecef;
        }

        .info-label {
            font-weight: 600;
            min-width: 60px;
            color: #666;
            transition: color 0.3s ease;
        }

        body.dark-theme .info-label {
            color: #adb5bd;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 10px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .status-open {
            background: #d1e7dd;
            color: #0f5132;
        }

        body.dark-theme .status-open {
            background: #1b5e20;
            color: #81c784;
        }

        .status-full {
            background: #f8d7da;
            color: #842029;
        }

        body.dark-theme .status-full {
            background: #5e1b1b;
            color: #ef9a9a;
        }

        /* æ¸…å–®æ¨¡å¼æ¨£å¼ */
        .calendar-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .list-item {
            background: white;
            padding: 15px 25px;
            border-radius: 10px;
            display: grid;
            grid-template-columns: 120px 1fr 150px 150px 100px;
            align-items: center;
            gap: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            color: #333;
        }

        body.dark-theme .list-item {
            background: #1e1e1e;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border: 1px solid #2d2d2d;
            color: #e9ecef;
        }

        @media (max-width: 992px) {
            .list-item {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }
        }

        @media (max-width: 576px) {
            .list-item {
                grid-template-columns: 1fr;
            }
            h1 { font-size: 1.8rem; }
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2rem;
            color: #666;
            transition: color 0.3s ease;
        }

        body.dark-theme .loading {
            color: #adb5bd;
        }

        .error-msg {
            background: #f8d7da;
            color: #842029;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        body.dark-theme .error-msg {
            background: #5e1b1b;
            color: #ef9a9a;
            border: 1px solid #7d2d2d;
        }

        .last-update {
            text-align: right;
            font-size: 0.8rem;
            color: #999;
            margin-top: 10px;
            transition: color 0.3s ease;
        }

        body.dark-theme .last-update {
            color: #666;
        }

        .demo-notice {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 10px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            text-align: center;
        }

        body.dark-theme .demo-notice {
            background: #332b00;
            border-color: #665500;
            color: #ffecb5;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div class="logo-container">
                    <img src="https://i.imgur.com/8N6v6Xm.png" alt="è¡€æŸ“é˜æ¨“ Logo" class="logo">
                </div>
                <h1>è¡€æŸ“é˜æ¨“æ´»å‹•è¡Œäº‹æ›†</h1>
                <p class="author">by æ›‰é¢¨</p>
                <div class="controls">
                    <button id="gridBtn" class="btn active">ğŸ–¥ï¸ ç¶²æ ¼æ¨¡å¼</button>
                    <button id="listBtn" class="btn">ğŸ“± æ¸…å–®æ¨¡å¼</button>
                    <button id="themeBtn" class="btn">ğŸŒ™ æš—è‰²ä¸»é¡Œ</button>
                    <button id="refreshBtn" class="btn">ğŸ”„ é‡æ–°æ•´ç†</button>
                </div>
            </div>
        </header>

        <div id="demoNotice"></div>

        <div class="filter-section">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="æœå°‹åŠ‡æœ¬ã€èªªæ›¸äººæˆ–åœ°é»...">
            </div>
            <div class="location-filters" id="locationFilters">
                <span>åœ°é»ç¯©é¸ï¼š</span>
                <div class="location-tag active" data-location="all">é¡¯ç¤ºæ‰€æœ‰åœ°é»çš„æ´»å‹•</div>
            </div>
        </div>

        <div id="calendarContainer">
            <div class="loading">è¼‰å…¥ä¸­...</div>
        </div>

        <div class="last-update" id="lastUpdate"></div>
    </div>

    <script>
        // è¨­å®š
        const CONFIG = {
            // æ›¿æ›ç‚ºä½ çš„ Google Apps Script éƒ¨ç½²ç¶²å€
            API_URL: 'https://script.google.com/macros/s/AKfycbz_9_9_9_9_9_9_9_9_9_9_9_9_9_9_9_9_9_9_9_9/exec',
            LOCATIONS: {
                '101é˜æ¨“': '#0d6efd',
                'æ­ªå¸¸ç ”ç©¶æ‰€': '#af52de',
                'å°æ€ªè³‡å®¶é•·æœƒ': '#198754'
            }
        };

        // ç¯„ä¾‹è³‡æ–™ï¼ˆç•¶ API å¤±æ•—æ™‚é¡¯ç¤ºï¼‰
        const MOCK_DATA = [
            { date: '2026-01-20', time: '19:00', title: 'è¡€æŸ“é˜æ¨“ï¼šæš—æµæ¹§å‹•', storyteller: 'æ›‰é¢¨', location: '101é˜æ¨“', players: '8-12äºº', status: 'å ±åä¸­' },
            { date: '2026-01-21', time: '14:00', title: 'è¡€æŸ“é˜æ¨“ï¼šé»¯æœˆå­¤å…’', storyteller: 'å°æ˜', location: 'æ­ªå¸¸ç ”ç©¶æ‰€', players: '10-15äºº', status: 'å·²æ»¿' },
            { date: '2026-01-22', time: '19:30', title: 'è¡€æŸ“é˜æ¨“ï¼šæ•™æ´¾èˆ‡ç´«ç¾…è˜­', storyteller: 'æ›‰é¢¨', location: 'å°æ€ªè³‡å®¶é•·æœƒ', players: '9-13äºº', status: 'å ±åä¸­' }
        ];

        let allEvents = [];
        let currentView = 'grid';
        let currentFilter = 'all';
        let currentSearch = '';

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            
            // æª¢æŸ¥æœ¬åœ°å„²å­˜çš„ä¸»é¡Œè¨­å®š
            const savedTheme = localStorage.getItem('darkTheme');
            if (savedTheme === 'true') {
                document.body.classList.add('dark-theme');
                document.getElementById('themeBtn').innerHTML = 'â˜€ï¸ äº®è‰²ä¸»é¡Œ';
            }
            
            fetchData();
        });

        function setupEventListeners() {
            document.getElementById('gridBtn').addEventListener('click', () => switchView('grid'));
            document.getElementById('listBtn').addEventListener('click', () => switchView('list'));
            document.getElementById('themeBtn').addEventListener('click', toggleTheme);
            document.getElementById('refreshBtn').addEventListener('click', fetchData);
            
            document.getElementById('searchInput').addEventListener('input', (e) => {
                currentSearch = e.target.value.toLowerCase();
                renderEvents();
            });

            document.getElementById('locationFilters').addEventListener('click', (e) => {
                if (e.target.classList.contains('location-tag')) {
                    document.querySelectorAll('.location-tag').forEach(tag => tag.classList.remove('active'));
                    e.target.classList.add('active');
                    currentFilter = e.target.dataset.location;
                    renderEvents();
                }
            });
        }

        async function fetchData() {
            const container = document.getElementById('calendarContainer');
            container.innerHTML = '<div class="loading">è¼‰å…¥ä¸­...</div>';
            document.getElementById('demoNotice').innerHTML = '';
            
            try {
                // æª¢æŸ¥æ˜¯å¦ç‚ºä½”ä½ç¬¦ç¶²å€
                if (CONFIG.API_URL.includes('AKfycbz_9_9_9')) {
                    throw new Error('æœªè¨­å®šæœ‰æ•ˆçš„ API ç¶²å€');
                }

                const response = await fetch(CONFIG.API_URL);
                if (!response.ok) throw new Error('ç¶²è·¯è«‹æ±‚å¤±æ•—');
                
                const data = await response.json();
                if (data.status === 'success') {
                    allEvents = data.data;
                    renderEvents();
                    renderLocationFilters();
                    updateTimestamp();
                } else {
                    throw new Error('è³‡æ–™æ ¼å¼éŒ¯èª¤');
                }
            } catch (error) {
                console.warn('Fetch error, using mock data:', error.message);
                // API å¤±æ•—æ™‚ä½¿ç”¨ç¯„ä¾‹è³‡æ–™
                allEvents = MOCK_DATA;
                renderEvents();
                renderLocationFilters();
                updateTimestamp();
                
                // é¡¯ç¤ºæç¤ºè¨Šæ¯
                document.getElementById('demoNotice').innerHTML = `
                    <div class="demo-notice">
                        âš ï¸ ç›®å‰é¡¯ç¤ºçš„æ˜¯ç¯„ä¾‹è³‡æ–™ã€‚è«‹åœ¨ç¨‹å¼ç¢¼ä¸­è¨­å®šæ­£ç¢ºçš„ <code>API_URL</code> ä»¥é€£æ¥æ‚¨çš„ Google Sheetsã€‚
                    </div>
                `;
            }
        }

        function renderLocationFilters() {
            const filterContainer = document.getElementById('locationFilters');
            const locations = [...new Set(allEvents.map(event => event.location))];
            
            filterContainer.innerHTML = `
                <span>åœ°é»ç¯©é¸ï¼š</span>
                <div class="location-tag ${currentFilter === 'all' ? 'active' : ''}" data-location="all">é¡¯ç¤ºæ‰€æœ‰åœ°é»çš„æ´»å‹•</div>
            `;
            
            locations.forEach(loc => {
                if (loc) {
                    const tag = document.createElement('div');
                    tag.className = `location-tag ${currentFilter === loc ? 'active' : ''}`;
                    tag.dataset.location = loc;
                    tag.textContent = loc;
                    filterContainer.appendChild(tag);
                }
            });
        }

        function renderEvents() {
            const container = document.getElementById('calendarContainer');
            
            const filteredEvents = allEvents.filter(event => {
                const matchesFilter = currentFilter === 'all' || event.location === currentFilter;
                const matchesSearch = !currentSearch || 
                    event.title.toLowerCase().includes(currentSearch) ||
                    event.storyteller.toLowerCase().includes(currentSearch) ||
                    event.location.toLowerCase().includes(currentSearch);
                return matchesFilter && matchesSearch;
            });

            if (filteredEvents.length === 0) {
                container.innerHTML = '<div class="loading">ç›®å‰æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„æ´»å‹•ã€‚</div>';
                return;
            }

            if (currentView === 'grid') {
                renderGridView(filteredEvents, container);
            } else {
                renderListView(filteredEvents, container);
            }
        }

        function renderGridView(events, container) {
            let html = '<div class="calendar-grid">';
            events.forEach(event => {
                const borderColor = CONFIG.LOCATIONS[event.location] || '#6c757d';
                const statusClass = event.status === 'å ±åä¸­' ? 'status-open' : 'status-full';
                
                html += `
                    <div class="event-card" style="border-left-color: ${borderColor}">
                        <div class="event-header">
                            <div class="event-date">${event.date} ${event.time}</div>
                            <div class="event-title">${event.title}</div>
                        </div>
                        <div class="event-body">
                            <div class="info-item">
                                <span class="info-label">èªªæ›¸äºº</span>
                                <span>${event.storyteller}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">åœ°é»</span>
                                <span>${event.location}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">äººæ•¸</span>
                                <span>${event.players}</span>
                            </div>
                            <div class="status-badge ${statusClass}">${event.status}</div>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function renderListView(events, container) {
            let html = '<div class="calendar-list">';
            events.forEach(event => {
                const statusClass = event.status === 'å ±åä¸­' ? 'status-open' : 'status-full';
                html += `
                    <div class="list-item">
                        <div class="event-date">${event.date} ${event.time}</div>
                        <div class="event-title">${event.title}</div>
                        <div>èªªæ›¸äººï¼š${event.storyteller}</div>
                        <div>åœ°é»ï¼š${event.location}</div>
                        <div class="status-badge ${statusClass}">${event.status}</div>
                    </div>
                `;
            });
            html += '</div>';
            container.innerHTML = html;
        }

        function switchView(view) {
            currentView = view;
            document.getElementById('gridBtn').classList.toggle('active', view === 'grid');
            document.getElementById('listBtn').classList.toggle('active', view === 'list');
            renderEvents();
        }

        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark-theme');
            localStorage.setItem('darkTheme', isDark);
            document.getElementById('themeBtn').innerHTML = isDark ? 'â˜€ï¸ äº®è‰²ä¸»é¡Œ' : 'ğŸŒ™ æš—è‰²ä¸»é¡Œ';
        }

        function updateTimestamp() {
            const now = new Date();
            const timeStr = now.toLocaleString('zh-TW', { 
                year: 'numeric', month: '2-digit', day: '2-digit', 
                hour: '2-digit', minute: '2-digit' 
            });
            document.getElementById('lastUpdate').textContent = `æ›´æ–°æ™‚é–“ï¼š${timeStr}`;
        }
    </script>
</body>
</html>
